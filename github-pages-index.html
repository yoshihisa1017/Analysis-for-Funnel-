<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>愛車メーター ファネル分析</title>
    <!-- Chart.js - 安定したCDNから読み込み -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* ベーススタイル */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        h1, h2, h3 {
            margin-top: 0;
            color: #2a4365;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        h2 {
            margin-top: 30px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        /* グリッド レイアウト */
        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 768px) {
            .grid-3 {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* カード スタイル */
        .card {
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-blue {
            background-color: #ebf8ff;
            border: 1px solid #bee3f8;
        }
        
        .card-green {
            background-color: #f0fff4;
            border: 1px solid #c6f6d5;
        }
        
        .card-purple {
            background-color: #faf5ff;
            border: 1px solid #e9d8fd;
        }
        
        .card-red {
            background-color: #fff5f5;
            border: 1px solid #fed7d7;
        }
        
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c5282;
        }
        
        .card-blue .card-title { color: #2c5282; }
        .card-green .card-title { color: #276749; }
        .card-purple .card-title { color: #553c9a; }
        .card-red .card-title { color: #9b2c2c; }
        
        .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .card-blue .card-value { color: #3182ce; }
        .card-green .card-value { color: #38a169; }
        .card-purple .card-value { color: #805ad5; }
        .card-red .card-value { color: #e53e3e; }
        
        .card-subtitle {
            font-size: 0.9rem;
            color: #718096;
        }
        
        /* チャートコンテナ */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin-bottom: 30px;
        }
        
        /* ファネルバー */
        .funnel-container {
            margin-bottom: 30px;
        }
        
        .funnel-bar {
            height: 50px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            padding-left: 15px;
            color: white;
            font-weight: bold;
            border-radius: 4px;
            transition: width 0.8s ease-in-out;
            background-color: #3182ce;
            overflow: hidden;
            white-space: nowrap;
        }
        
        .funnel-bar.purple {
            background-color: #805ad5;
        }
        
        /* タブ */
        .tabs {
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .tab-buttons {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .tab-button {
            padding: 10px 20px;
            background-color: #f7fafc;
            cursor: pointer;
            border: 1px solid #e2e8f0;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
            font-weight: 500;
        }
        
        .tab-button.active {
            background-color: #3182ce;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* テーブル スタイル */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 10px;
            text-align: left;
        }
        
        th {
            background-color: #f7fafc;
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f7fafc;
        }
        
        /* ボタン */
        .button {
            display: inline-block;
            padding: 8px 16px;
            background-color: #3182ce;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .button:hover {
            background-color: #2c5282;
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .button-group button {
            margin: 0 5px;
            padding: 8px 16px;
            background-color: #e2e8f0;
            color: #4a5568;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .button-group button.active {
            background-color: #3182ce;
            color: white;
        }
        
        /* 改善提案 */
        .proposal {
            margin-top: 30px;
            padding: 20px;
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        
        .proposal-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2a4365;
        }
        
        .proposal-items {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        @media (min-width: 768px) {
            .proposal-items {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .proposal-item {
            padding: 15px;
            border-radius: 4px;
        }
        
        .proposal-item-title {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .proposal-item-blue {
            background-color: #ebf8ff;
            border: 1px solid #bee3f8;
        }
        
        .proposal-item-blue .proposal-item-title {
            color: #2c5282;
        }
        
        .proposal-item-purple {
            background-color: #faf5ff;
            border: 1px solid #e9d8fd;
        }
        
        .proposal-item-purple .proposal-item-title {
            color: #553c9a;
        }
        
        .details-toggle {
            margin-top: 10px;
            color: #4a5568;
            cursor: pointer;
            font-size: 0.9rem;
            display: inline-block;
        }
        
        .details-content {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 4px;
        }
        
        .details-content.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .details-content ul {
            margin: 0;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>愛車メーター ファネル分析</h1>
        
        <!-- 期間選択 -->
        <div class="button-group">
            <button class="period-button active" data-period="all">全期間</button>
            <button class="period-button" data-period="feb">2月</button>
            <button class="period-button" data-period="mar">3月</button>
            <button class="period-button" data-period="week">週別表示</button>
        </div>
        
        <!-- 概要指標 -->
        <div class="grid grid-3">
            <div class="card card-blue">
                <div class="card-title">全体コンバージョン率</div>
                <div class="card-value"><span id="overallConversionRate">3.56</span>%</div>
                <div class="card-subtitle">総アクセス数: <span id="totalAccess">24,999</span></div>
            </div>
            <div class="card card-green">
                <div class="card-title">正常ルート効率</div>
                <div class="card-value"><span id="normalRouteRate">2.55</span>%</div>
                <div class="card-subtitle">初期ユーザー: <span id="normalUsers">21,866</span>人</div>
            </div>
            <div class="card card-purple">
                <div class="card-title">概算ルート効率</div>
                <div class="card-value"><span id="alternativeRouteRate">32.05</span>%</div>
                <div class="card-subtitle">初期ユーザー: <span id="alternativeUsers">1,039</span>人</div>
            </div>
        </div>
        
        <!-- タブメニュー -->
        <div class="tabs">
            <ul class="tab-buttons">
                <li class="tab-button active" data-tab="funnels">ファネル分析</li>
                <li class="tab-button" data-tab="charts">グラフ分析</li>
                <li class="tab-button" data-tab="details">詳細データ</li>
            </ul>
        </div>
        
        <!-- タブコンテンツ: ファネル分析 -->
        <div id="funnels" class="tab-content active">
            <!-- 正常ルートファネル -->
            <h2>正常ルートファネル</h2>
            <div class="funnel-container" id="normal-funnel">
                <div class="funnel-bar" style="width: 0%;" data-width="100">アクセス: <span class="access-count">24,999</span> (100%)</div>
                <div class="funnel-bar" style="width: 0%;" data-width="91.62">結果表示ボタン押下: <span class="button-count">22,905</span> (91.62%)</div>
                <div class="funnel-bar" style="width: 0%;" data-width="87.5">正常に結果表示: <span class="display-count">21,866</span> (95.46%)</div>
                <div class="funnel-bar" style="width: 0%;" data-width="15.0">保存ボタン押下: <span class="save-button-count">3,771</span> (17.25%)</div>
                <div class="funnel-bar" style="width: 0%;" data-width="15.4">実際の保存: <span class="actual-save-count">3,849</span> (102.07%)</div>
                <div class="funnel-bar" style="width: 0%;" data-width="5.75">正式査定進行: <span class="assessment-count">1,438</span> (37.36%)</div>
                <div class="funnel-bar" style="width: 0%;" data-width="2.23">査定依頼: <span class="request-count">557</span> (38.73%)</div>
            </div>

            <!-- 概算査定ルートファネル -->
            <h2>概算査定ルートファネル</h2>
            <div class="funnel-container" id="alternative-funnel">
                <div class="funnel-bar purple" style="width: 0%;" data-width="4.5">結果表示できず: <span class="not-display-count">1,039</span> (4.5%)</div>
                <div class="funnel-bar purple" style="width: 0%;" data-width="1.5">概算査定フォーム申込: <span class="form-apply-count">333</span> (32.1%)</div>
                <div class="funnel-bar purple" style="width: 0%;" data-width="3.0">概算査定完了: <span class="form-complete-count">706</span> (67.9%)</div>
            </div>

            <!-- ボトルネック分析 -->
            <div class="card card-red">
                <div class="card-title">主要ボトルネック</div>
                <div class="card-value">正常表示 → 保存ボタン押下</div>
                <div class="card-subtitle">離脱率: <span id="bottleneck-rate">82.75</span>%</div>
                <div class="card-subtitle"><span id="bottleneck-users">21,866</span>人中<span id="bottleneck-dropout">18,095</span>人がこのステップで離脱</div>
                
                <div class="details-toggle" id="bottleneckToggle">詳細分析を表示 ▼</div>
                <div class="details-content" id="bottleneckDetails">
                    <h4>ボトルネック改善シミュレーション</h4>
                    <p>保存ボタン押下率が向上した場合のコンバージョン予測:</p>
                    <div class="grid grid-3">
                        <div>現状 (17.25%): <strong>2.55%</strong></div>
                        <div>2倍 (34.5%): <strong>5.1%</strong></div>
                        <div>3倍 (51.75%): <strong>7.65%</strong></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- タブコンテンツ: グラフ分析 -->
        <div id="charts" class="tab-content">
            <!-- コンバージョン分布と効率比較 -->
            <div class="grid grid-2">
                <div>
                    <h2>コンバージョン分布</h2>
                    <div class="chart-container">
                        <canvas id="conversionDistribution"></canvas>
                    </div>
                </div>
                <div>
                    <h2>ルート効率比較</h2>
                    <div class="chart-container">
                        <canvas id="routeEfficiency"></canvas>
                    </div>
                </div>
            </div>

            <!-- 週ごとの傾向 -->
            <h2>週ごとの傾向</h2>
            <div class="chart-container">
                <canvas id="weeklyTrend"></canvas>
            </div>

            <!-- 各ステップの離脱率 -->
            <h2>各ステップの離脱率</h2>
            <div class="chart-container">
                <canvas id="dropoffRates"></canvas>
            </div>
        </div>
        
        <!-- タブコンテンツ: 詳細データ -->
        <div id="details" class="tab-content">
            <h2>週別集計データ</h2>
            <table>
                <thead>
                    <tr>
                        <th>週</th>
                        <th>アクセス数</th>
                        <th>正常ルート率</th>
                        <th>概算ルート率</th>
                        <th>全体変換率</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2月1週</td>
                        <td>1,081</td>
                        <td>1.76%</td>
                        <td>1.48%</td>
                        <td>3.24%</td>
                    </tr>
                    <tr>
                        <td>2月2週</td>
                        <td>7,218</td>
                        <td>2.11%</td>
                        <td>2.01%</td>
                        <td>4.11%</td>
                    </tr>
                    <tr>
                        <td>2月3週</td>
                        <td>6,791</td>
                        <td>1.94%</td>
                        <td>1.63%</td>
                        <td>3.58%</td>
                    </tr>
                    <tr>
                        <td>2月4週</td>
                        <td>5,754</td>
                        <td>2.28%</td>
                        <td>1.06%</td>
                        <td>3.34%</td>
                    </tr>
                    <tr>
                        <td>3月1週</td>
                        <td>4,155</td>
                        <td>2.94%</td>
                        <td>0.00%</td>
                        <td>2.94%</td>
                    </tr>
                </tbody>
            </table>
            
            <h2>概算査定フォームパフォーマンス</h2>
            <table>
                <thead>
                    <tr>
                        <th>日付</th>
                        <th>変換率</th>
                        <th>遷移数</th>
                        <th>申込数</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2025-02-11</td>
                        <td>27.59%</td>
                        <td>87</td>
                        <td>24</td>
                    </tr>
                    <tr>
                        <td>2025-02-09</td>
                        <td>26.50%</td>
                        <td>117</td>
                        <td>31</td>
                    </tr>
                    <tr>
                        <td>2025-02-13</td>
                        <td>25.68%</td>
                        <td>74</td>
                        <td>19</td>
                    </tr>
                    <tr>
                        <td>2025-02-17</td>
                        <td>25.33%</td>
                        <td>75</td>
                        <td>19</td>
                    </tr>
                    <tr>
                        <td>2025-02-10</td>
                        <td>24.68%</td>
                        <td>77</td>
                        <td>19</td>
                    </tr>
                    <tr>
                        <td>平均</td>
                        <td>19.88%</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- 総合評価 -->
        <div class="proposal">
            <div class="proposal-title">総合評価と提案</div>
            <div class="proposal-items">
                <div class="proposal-item proposal-item-blue">
                    <div class="proposal-item-title">正常ルート最適化</div>
                    <p>正常表示から保存ボタン押下へのステップを最適化することで、全体のコンバージョン率を大幅に向上できる可能性があります。</p>
                    <div class="details-toggle" id="proposal1Toggle">詳細を見る ▼</div>
                    <div class="details-content" id="proposal1Details">
                        <ul>
                            <li>保存ボタンの視認性向上</li>
                            <li>保存のメリットを明確に表示</li>
                            <li>保存プロセスの簡略化</li>
                            <li>フォローアップメールの強化</li>
                        </ul>
                    </div>
                </div>
                <div class="proposal-item proposal-item-purple">
                    <div class="proposal-item-title">概算ルートの効率活用</div>
                    <p>概算ルートのコンバージョン率は32.05%と非常に高いため、このルートをより多くのユーザーに活用できる方法を検討する価値があります。</p>
                    <div class="details-toggle" id="proposal2Toggle">詳細を見る ▼</div>
                    <div class="details-content" id="proposal2Details">
                        <ul>
                            <li>特定条件下で意図的に概算ルートへ誘導</li>
                            <li>概算査定フォームのUI/UX改善</li>
                            <li>3月の概算ルート停止原因の調査</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // データセット
        const allData = {
            summary: {
                overallConversionRate: 3.56,
                totalAccess: 24999,
                normalRouteRate: 2.55,
                normalUsers: 21866,
                alternativeRouteRate: 32.05,
                alternativeUsers: 1039,
                bottleneckRate: 82.75,
                bottleneckUsers: 21866,
                bottleneckDropout: 18095
            },
            february: {
                overallConversionRate: 3.84,
                totalAccess: 20844,
                normalRouteRate: 2.33,
                normalUsers: 17956,
                alternativeRouteRate: 32.05,
                alternativeUsers: 1039,
                bottleneckRate: 81.72,
                bottleneckUsers: 17956,
                bottleneckDropout: 14676
            },
            march: {
                overallConversionRate: 2.94,
                totalAccess: 4155,
                normalRouteRate: 2.94,
                normalUsers: 3910,
                alternativeRouteRate: 0,
                alternativeUsers: 0,
                bottleneckRate: 85.71,
                bottleneckUsers: 3910,
                bottleneckDropout: 3351
            },
            weekly: {
                labels: ['2月1週', '2月2週', '2月3週', '2月4週', '3月1週'],
                normalRoute: [1.76, 2.11, 1.94, 2.28, 2.94],
                alternativeRoute: [1.48, 2.01, 1.63, 1.06, 0.00],
                totalRate: [3.24, 4.11, 3.58, 3.34, 2.94]
            }
        };

        // チャートインスタンス
        let conversionDistribution;
        let routeEfficiency;
        let weeklyTrend;
        let dropoffRates;

        // ページ読み込み完了時の処理
        document.addEventListener('DOMContentLoaded', function() {
            // ファネルバーのアニメーション
            animateFunnelBars();
            
            // チャート初期化
            initCharts();
            
            // イベントリスナー設定
            setupEventListeners();
        });

        // ファネルバーのアニメーション
        function animateFunnelBars() {
            const normalBars = document.querySelectorAll('#normal-funnel .funnel-bar');
            const alternativeBars = document.querySelectorAll('#alternative-funnel .funnel-bar');
            
            normalBars.forEach((bar, index) => {
                setTimeout(() => {
                    bar.style.width = bar.getAttribute('data-width') + '%';
                }, index * 200);
            });
            
            setTimeout(() => {
                alternativeBars.forEach((bar, index) => {
                    setTimeout(() => {
                        bar.style.width = bar.getAttribute('data-width') + '%';
                    }, index * 200);
                });
            }, normalBars.length * 200);
        }

        // チャート初期化
        function initCharts() {
            // コンバージョン分布グラフ
            conversionDistribution = new Chart(
                document.getElementById('conversionDistribution'),
                {
                    type: 'pie',
                    data: {
                        labels: ['正常ルート', '概算ルート'],
                        datasets: [{
                            data: [557, 333],
                            backgroundColor: ['#3182CE', '#805AD5'],
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'コンバージョン内訳（合計890件）'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const percentage = (context.raw / (557 + 333) * 100).toFixed(1);
                                        return `${context.label}: ${context.raw}件 (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        animation: {
                            animateRotate: true,
                            animateScale: true
                        }
                    }
                }
            );

            // ルート効率比較グラフ
            routeEfficiency = new Chart(
                document.getElementById('routeEfficiency'),
                {
                    type: 'bar',
                    data: {
                        labels: ['正常ルート', '概算ルート'],
                        datasets: [
                            {
                                label: 'コンバージョン率 (%)',
                                data: [2.55, 32.05],
                                backgroundColor: '#805AD5',
                                yAxisID: 'y1'
                            },
                            {
                                label: 'ユーザー数',
                                data: [21866, 1039],
                                backgroundColor: '#3182CE',
                                yAxisID: 'y'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'ユーザー数'
                                }
                            },
                            y1: {
                                type: 'linear',
                                position: 'right',
                                max: 35,
                                title: {
                                    display: true,
                                    text: 'コンバージョン率 (%)'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                }
                            }
                        },
                        animation: {
                            duration: 1000
                        }
                    }
                }
            );

            // 週ごとの傾向グラフ
            weeklyTrend = new Chart(
                document.getElementById('weeklyTrend'),
                {
                    type: 'line',
                    data: {
                        labels: allData.weekly.labels,
                        datasets: [
                            {
                                label: '正常ルート変換率 (%)',
                                data: allData.weekly.normalRoute,
                                borderColor: '#3182CE',
                                tension: 0.1
                            },
                            {
                                label: '概算ルート変換率 (%)',
                                data: allData.weekly.alternativeRoute,
                                borderColor: '#805AD5',
                                tension: 0.1
                            },
                            {
                                label: '全体変換率 (%)',
                                data: allData.weekly.totalRate,
                                borderColor: '#38A169',
                                tension: 0.1,
                                pointRadius: 6
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        }
                    }
                }
            );

            // 各ステップの離脱率グラフ
            dropoffRates = new Chart(
                document.getElementById('dropoffRates'),
                {
                    type: 'bar',
                    data: {
                        labels: [
                            'アクセス→結果表示',
                            '結果表示→正常表示',
                            '正常表示→保存ボタン',
                            '保存ボタン→保存',
                            '保存→正式査定進行',
                            '正式査定進行→依頼'
                        ],
                        datasets: [{
                            label: '離脱率 (%)',
                            data: [8.38, 4.54, 82.75, -2.07, 62.64, 61.27],
                            backgroundColor: '#E53E3E',
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                }
            );
        }

        // イベントリスナー設定
        function setupEventListeners() {
            // タブ切り替え
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // アクティブタブの切り替え
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // タブコンテンツの切り替え
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                    
                    // チャートの再描画
                    if (tabId === 'charts') {
                        setTimeout(() => {
                            conversionDistribution.update();
                            routeEfficiency.update();
                            weeklyTrend.update();
                            dropoffRates.update();
                        }, 100);
                    }
                });
            });
            
            // 期間選択
            document.querySelectorAll('.period-button').forEach(button => {
                button.addEventListener('click', function() {
                    const period = this.getAttribute('data-period');
                    
                    // アクティブボタンの切り替え
                    document.querySelectorAll('.period-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // データの更新
                    updateData(period);
                });
            });
            
            // 詳細トグル
            document.getElementById('bottleneckToggle').addEventListener('click', function() {
                toggleDetails('bottleneckDetails', this);
            });
            
            document.getElementById('proposal1Toggle').addEventListener('click', function() {
                toggleDetails('proposal1Details', this);
            });
            
            document.getElementById('proposal2Toggle').addEventListener('click', function() {
                toggleDetails('proposal2Details', this);
            });
        }
        
        // 詳細表示の切り替え
        function toggleDetails(detailsId, toggleButton) {
            const details = document.getElementById(detailsId);
            if (details.classList.contains('visible')) {
                details.classList.remove('visible');
                toggleButton.textContent = toggleButton.textContent.replace('▲', '▼');
            } else {
                details.classList.add('visible');
                toggleButton.textContent = toggleButton.textContent.replace('▼', '▲');
            }
        }

        // データ更新
        function updateData(period) {
            let data;
            
            // 期間に応じたデータを選択
            if (period === 'feb') {
                data = allData.february;
            } else if (period === 'mar') {
                data = allData.march;
            } else {
                data = allData.summary;
            }
            
            // 要約指標の更新
            document.getElementById('overallConversionRate').textContent = data.overallConversionRate;
            document.getElementById('totalAccess').textContent = data.totalAccess.toLocaleString();
            document.getElementById('normalRouteRate').textContent = data.normalRouteRate;
            document.getElementById('normalUsers').textContent = data.normalUsers.toLocaleString();
            document.getElementById('alternativeRouteRate').textContent = data.alternativeRouteRate;
            document.getElementById('alternativeUsers').textContent = data.alternativeUsers.toLocaleString();
            document.getElementById('bottleneck-rate').textContent = data.bottleneckRate;
            document.getElementById('bottleneck-users').textContent = data.bottleneckUsers.toLocaleString();
            document.getElementById('bottleneck-dropout').textContent = data.bottleneckDropout.toLocaleString();
            
            // 週別表示の場合
            if (period === 'week') {
                // チャートタブをアクティブに
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('[data-tab="charts"]').classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('charts').classList.add('active');
                
                // 週ごとの傾向グラフにフォーカス
                weeklyTrend.update();
            }
        }
    </script>
</body>
</html>
